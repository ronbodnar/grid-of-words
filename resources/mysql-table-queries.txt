CREATE TABLE games(
	id BINARY(16) DEFAULT (UUID_TO_BIN(UUID())) NOT NULL PRIMARY KEY,
	owner_id BINARY(16) DEFAULT NULL,
	word VARCHAR(50) NOT NULL,
	max_attempts INTEGER NOT NULL,
	state ENUM('STARTED', 'FORFEIT', 'WIN', 'LOSS') DEFAULT 'STARTED' NOT NULL,
	start_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP() NOT NULL,
	end_timestamp TIMESTAMP,
	timed TINYINT(1) DEFAULT 0 NOT NULL
);

CREATE TABLE game_attempts(
	id INTEGER PRIMARY KEY NOT NULL AUTO_INCREMENT,
    game_id BINARY(16) NOT NULL,
    attempted_word VARCHAR(50) NOT NULL
);

CREATE TABLE words(
	id INT NOT NULL PRIMARY KEY AUTO_INCREMENT,
	text VARCHAR(100) NOT NULL,
	CONSTRAINT chk_text_length CHECK (CHAR_LENGTH(text) > 0),
	INDEX idx_text (text)
);

CREATE TABLE users(
	id BINARY(16) DEFAULT (UUID_TO_BIN(UUID())) NOT NULL PRIMARY KEY,
	email VARCHAR(50) NOT NULL,
    username VARCHAR(50) NOT NULL,
    hash VARCHAR(100) NOT NULL,
    creation_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP() NOT NULL,
	enabled TINYINT(1) DEFAULT 1 NOT NULL,
	password_reset_token VARCHAR(64) DEFAULT NULL
	password_reset_token_expiration TIMESTAMP DEFAULT NULL,
	INDEX idx_email (email),
	INDEX idx_id (id)
);

CREATE TABLE user_games(
	user_id BINARY(16) NOT NULL,
	game_id BINARY(16) NOT NULL
);